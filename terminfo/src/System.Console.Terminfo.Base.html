<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CApiFFI #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  : judah.jacobson@gmail.com</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Portability : portable (FFI)</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- This module provides a low-level interface to the C functions of the </span><span>
</span><span id="line-12"></span><span class="hs-comment">-- terminfo library. </span><span>
</span><span id="line-13"></span><span class="hs-comment">-- </span><span>
</span><span id="line-14"></span><span class="hs-comment">-- NOTE: Since this library is built on top of the curses interface, it is not thread-safe.</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html"><span class="hs-identifier">System.Console.Terminfo.Base</span></a></span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>                            </span><span class="annot"><span class="hs-comment">-- *  Initialization</span></span><span>
</span><span id="line-18"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier">Terminal</span></a></span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#setupTerm"><span class="hs-identifier">setupTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#setupTermFromEnv"><span class="hs-identifier">setupTermFromEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier">SetupTermError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>                            </span><span class="annot"><span class="hs-comment">-- * Capabilities</span></span><span>
</span><span id="line-23"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier">Capability</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#getCapability"><span class="hs-identifier">getCapability</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetFlag"><span class="hs-identifier">tiGetFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGuardFlag"><span class="hs-identifier">tiGuardFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetNum"><span class="hs-identifier">tiGetNum</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier">tiGetStr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>                            </span><span class="annot"><span class="hs-comment">-- * Output</span></span><span>
</span><span id="line-30"></span><span>                            </span><span class="annot"><span class="hs-comment">-- $outputdoc</span></span><span>
</span><span id="line-31"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetOutput1"><span class="hs-identifier">tiGetOutput1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier">OutputCap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier">TermStr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>                            </span><span class="annot"><span class="hs-comment">-- ** TermOutput</span></span><span>
</span><span id="line-35"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier">TermOutput</span></a></span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#runTermOutput"><span class="hs-identifier">runTermOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#hRunTermOutput"><span class="hs-identifier">hRunTermOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#termText"><span class="hs-identifier">termText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetOutput"><span class="hs-identifier">tiGetOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier">LinesAffected</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>                            </span><span class="annot"><span class="hs-comment">-- ** Monoid functions</span></span><span>
</span><span id="line-42"></span><span>                            </span><span class="annot"><span class="hs-identifier">Monoid</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>                            </span><span class="annot"><a href="System.Console.Terminfo.Base.html#%3C%23%3E"><span class="hs-operator">(&lt;#&gt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>                            </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sem</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Foreign.C.html"><span class="hs-identifier">Foreign.C</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Foreign.ForeignPtr.html"><span class="hs-identifier">Foreign.ForeignPtr</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Foreign.Ptr.html"><span class="hs-identifier">Foreign.Ptr</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Foreign.Marshal.html"><span class="hs-identifier">Foreign.Marshal</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Foreign.Storable.html"><span class="hs-identifier">Foreign.Storable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">peek</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/System.Environment.html"><span class="hs-identifier">System.Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getEnv</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.21.0.0-inplace/src/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">data</span><span> </span><span id="TERMINAL"><span class="annot"><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-var">TERMINAL</span></a></span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | 'Terminal' objects are automatically freed by the garbage collector.</span><span>
</span><span id="line-65"></span><span class="hs-comment">--   Hence, there is no equivalent of @del_curterm@ here.</span><span>
</span><span id="line-66"></span><span class="hs-keyword">newtype</span><span> </span><span id="Terminal"><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-var">Terminal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Terminal"><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-var">Terminal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForeignPtr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- Use &quot;unsafe&quot; to make set_curterm faster since it's called quite a bit.</span><span>
</span><span id="line-69"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span id="set_curterm"><span class="annot"><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-var">set_curterm</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&amp;&quot;</span></span><span> </span><span id="del_curterm"><span class="annot"><a href="System.Console.Terminfo.Base.html#del_curterm"><span class="hs-identifier hs-var">del_curterm</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span id="setupterm"><span class="annot"><a href="System.Console.Terminfo.Base.html#setupterm"><span class="hs-identifier hs-var">setupterm</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Initialize the terminfo library to the given terminal entry.</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- </span><span>
</span><span id="line-76"></span><span class="hs-comment">-- Throws a 'SetupTermError' if the terminfo database could not be read.</span><span>
</span><span id="line-77"></span><span class="hs-comment">--</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- *Note:* @ncurses@ is not thread-safe; initializing or using multiple</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- 'Terminal's in different threads at the same time can result in memory</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- unsafety.</span><span>
</span><span id="line-81"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#setupTerm"><span class="hs-identifier hs-type">setupTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span>
</span><span id="line-82"></span><span id="setupTerm"><span class="annot"><span class="annottext">setupTerm :: String -&gt; IO Terminal
</span><a href="System.Console.Terminfo.Base.html#setupTerm"><span class="hs-identifier hs-var hs-var">setupTerm</span></a></span></span><span> </span><span id="local-6989586621679044665"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044665"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO Terminal) -&gt; IO Terminal
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044665"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">((CString -&gt; IO Terminal) -&gt; IO Terminal)
-&gt; (CString -&gt; IO Terminal) -&gt; IO Terminal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044667"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679044667"><span class="hs-identifier hs-var">c_term</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">CInt -&gt; (Ptr CInt -&gt; IO Terminal) -&gt; IO Terminal
forall a b. Storable a =&gt; a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">with</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">((Ptr CInt -&gt; IO Terminal) -&gt; IO Terminal)
-&gt; (Ptr CInt -&gt; IO Terminal) -&gt; IO Terminal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044669"><span class="annot"><span class="annottext">Ptr CInt
</span><a href="#local-6989586621679044669"><span class="hs-identifier hs-var">ret_ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-comment">-- NOTE: I believe that for the way we use terminfo</span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-comment">-- (i.e. custom output function)</span><span>
</span><span id="line-87"></span><span>        </span><span class="hs-comment">-- this parameter does not affect anything.</span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679044671"><span class="annot"><span class="annottext">stdOutput :: CInt
</span><a href="#local-6989586621679044671"><span class="hs-identifier hs-var hs-var hs-var">stdOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">1</span></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-comment">-- Save the previous terminal to be restored after calling setupterm.</span><span>
</span><span id="line-90"></span><span>        </span><span id="local-6989586621679044672"><span class="annot"><a href="#local-6989586621679044672"><span class="hs-identifier hs-var">old_term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr TERMINAL -&gt; IO (Ptr TERMINAL)
</span><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-var">set_curterm</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr TERMINAL
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-comment">-- Call setupterm and check the return value.</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><a href="System.Console.Terminfo.Base.html#setupterm"><span class="hs-identifier hs-type">setupterm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044667"><span class="hs-identifier hs-type">c_term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044671"><span class="hs-identifier hs-type">stdOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044669"><span class="hs-identifier hs-type">ret_ptr</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span id="local-6989586621679044674"><span class="annot"><a href="#local-6989586621679044674"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679044669"><span class="hs-identifier hs-type">ret_ptr</span></a></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679044674"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">throwIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-type">SetupTermError</span></a></span><span>
</span><span id="line-96"></span><span>                </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Couldn't look up terminfo entry &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679044665"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-97"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>                </span><span id="local-6989586621679044678"><span class="annot"><a href="#local-6989586621679044678"><span class="hs-identifier hs-var">cterm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-type">set_curterm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044672"><span class="hs-identifier hs-type">old_term</span></a></span><span>
</span><span id="line-99"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">newForeignPtr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#del_curterm"><span class="hs-identifier hs-type">del_curterm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044678"><span class="hs-identifier hs-type">cterm</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">data</span><span> </span><span id="SetupTermError"><span class="annot"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-var">SetupTermError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SetupTermError"><span class="annot"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-var">SetupTermError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-102"></span><span>                        </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044681"><span id="local-6989586621679044686"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-type">SetupTermError</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679044689"><span class="annot"><span class="annottext">show :: SetupTermError -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-type">SetupTermError</span></a></span><span> </span><span id="local-6989586621679044690"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044690"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setupTerm: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044690"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044696"><span id="local-6989586621679044699"><span id="local-6989586621679044702"><span id="local-6989586621679044705"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-type">SetupTermError</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Initialize the terminfo library, using the @TERM@ environmental variable.</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- If @TERM@ is not set, we use the generic, minimal entry @dumb@.</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- </span><span>
</span><span id="line-112"></span><span class="hs-comment">-- Throws a 'SetupTermError' if the terminfo database could not be read.</span><span>
</span><span id="line-113"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#setupTermFromEnv"><span class="hs-identifier hs-type">setupTermFromEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span>
</span><span id="line-114"></span><span id="setupTermFromEnv"><span class="annot"><span class="annottext">setupTermFromEnv :: IO Terminal
</span><a href="System.Console.Terminfo.Base.html#setupTermFromEnv"><span class="hs-identifier hs-var hs-var">setupTermFromEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679044708"><span class="annot"><a href="#local-6989586621679044708"><span class="hs-identifier hs-var">env_term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO String) -&gt; IO String -&gt; IO String
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">handle</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO String
</span><a href="#local-6989586621679044710"><span class="hs-identifier hs-var">handleBadEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IO String) -&gt; IO String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">getEnv</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TERM&quot;</span></span><span> </span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679044712"><span class="annot"><a href="#local-6989586621679044712"><span class="hs-identifier hs-var hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044708"><span class="hs-identifier hs-var">env_term</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dumb&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044708"><span class="hs-identifier hs-var">env_term</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><a href="System.Console.Terminfo.Base.html#setupTerm"><span class="hs-identifier hs-type">setupTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044712"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="#local-6989586621679044710"><span class="hs-identifier hs-type">handleBadEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679044710"><span class="annot"><span class="annottext">handleBadEnv :: IOException -&gt; IO String
</span><a href="#local-6989586621679044710"><span class="hs-identifier hs-var hs-var">handleBadEnv</span></a></span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- TODO: this isn't really thread-safe...</span><span>
</span><span id="line-123"></span><span id="local-6989586621679044480"><span class="annot"><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-type">withCurTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679044480"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679044480"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-124"></span><span id="withCurTerm"><span class="annot"><span class="annottext">withCurTerm :: forall a. Terminal -&gt; IO a -&gt; IO a
</span><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-var hs-var">withCurTerm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span> </span><span id="local-6989586621679044719"><span class="annot"><span class="annottext">ForeignPtr TERMINAL
</span><a href="#local-6989586621679044719"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679044720"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679044720"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignPtr TERMINAL -&gt; (Ptr TERMINAL -&gt; IO a) -&gt; IO a
forall a b. ForeignPtr a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">withForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr TERMINAL
</span><a href="#local-6989586621679044719"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">((Ptr TERMINAL -&gt; IO a) -&gt; IO a) -&gt; (Ptr TERMINAL -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044722"><span class="annot"><span class="annottext">Ptr TERMINAL
</span><a href="#local-6989586621679044722"><span class="hs-identifier hs-var">cterm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>        </span><span id="local-6989586621679044723"><span class="annot"><a href="#local-6989586621679044723"><span class="hs-identifier hs-var">old_term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr TERMINAL -&gt; IO (Ptr TERMINAL)
</span><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-var">set_curterm</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr TERMINAL
</span><a href="#local-6989586621679044722"><span class="hs-identifier hs-var">cterm</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621679044724"><span class="annot"><a href="#local-6989586621679044724"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679044720"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-type">set_curterm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044723"><span class="hs-identifier hs-type">old_term</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679044724"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">-- Note I'm relying on this working even for strings with unset parameters.</span><span>
</span><span id="line-134"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-type">strHasPadding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-135"></span><span id="strHasPadding"><span class="annot"><span class="annottext">strHasPadding :: String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var hs-var">strHasPadding</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-136"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'$'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&lt;'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-137"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044726"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044726"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044726"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- | An action which sends output to the terminal.  That output may mix plain text with control</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- characters and escape sequences, along with delays (called \&quot;padding\&quot;) required by some older</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- terminals.</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- We structure this similarly to ShowS, so that appends don't cause space leaks.</span><span>
</span><span id="line-144"></span><span class="hs-keyword">newtype</span><span> </span><span id="TermOutput"><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermOutput"><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier hs-type">TermOutputType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier hs-type">TermOutputType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-keyword">data</span><span> </span><span id="TermOutputType"><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier hs-var">TermOutputType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TOCmd"><span class="annot"><a href="System.Console.Terminfo.Base.html#TOCmd"><span class="hs-identifier hs-var">TOCmd</span></a></span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-147"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="TOStr"><span class="annot"><a href="System.Console.Terminfo.Base.html#TOStr"><span class="hs-identifier hs-var">TOStr</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044732"><span id="local-6989586621679044736"><span class="annot"><span class="hs-identifier hs-type">Sem.Semigroup</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span> </span><span id="local-6989586621679044741"><span class="annot"><span class="annottext">[TermOutputType] -&gt; [TermOutputType]
</span><a href="#local-6989586621679044741"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679044742"><span class="annot"><span class="annottext">&lt;&gt; :: TermOutput -&gt; TermOutput -&gt; TermOutput
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span> </span><span id="local-6989586621679044743"><span class="annot"><span class="annottext">[TermOutputType] -&gt; [TermOutputType]
</span><a href="#local-6989586621679044743"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TermOutputType] -&gt; [TermOutputType]) -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TermOutputType] -&gt; [TermOutputType]
</span><a href="#local-6989586621679044741"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">([TermOutputType] -&gt; [TermOutputType])
-&gt; ([TermOutputType] -&gt; [TermOutputType])
-&gt; [TermOutputType]
-&gt; [TermOutputType]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[TermOutputType] -&gt; [TermOutputType]
</span><a href="#local-6989586621679044743"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044750"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679044754"><span class="annot"><span class="annottext">mempty :: TermOutput
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TermOutputType] -&gt; [TermOutputType]) -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a></span><span> </span><span class="annot"><span class="annottext">[TermOutputType] -&gt; [TermOutputType]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679044757"><span class="annot"><span class="annottext">mappend :: TermOutput -&gt; TermOutput -&gt; TermOutput
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TermOutput -&gt; TermOutput -&gt; TermOutput
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#termText"><span class="hs-identifier hs-type">termText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span> </span><span>
</span><span id="line-157"></span><span id="termText"><span class="annot"><span class="annottext">termText :: String -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#termText"><span class="hs-identifier hs-var hs-var">termText</span></a></span></span><span> </span><span id="local-6989586621679044758"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044758"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TermOutputType] -&gt; [TermOutputType]) -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TermOutputType
</span><a href="System.Console.Terminfo.Base.html#TOStr"><span class="hs-identifier hs-var">TOStr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044758"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">TermOutputType -&gt; [TermOutputType] -&gt; [TermOutputType]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">-- | Write the terminal output to the standard output device.</span></span><span>
</span><span id="line-160"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#runTermOutput"><span class="hs-identifier hs-type">runTermOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span id="runTermOutput"><span class="annot"><span class="annottext">runTermOutput :: Terminal -&gt; TermOutput -&gt; IO ()
</span><a href="System.Console.Terminfo.Base.html#runTermOutput"><span class="hs-identifier hs-var hs-var">runTermOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Terminal -&gt; TermOutput -&gt; IO ()
</span><a href="System.Console.Terminfo.Base.html#hRunTermOutput"><span class="hs-identifier hs-var">hRunTermOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdout</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Write the terminal output to the terminal or file managed by the given</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- 'Handle'.</span><span>
</span><span id="line-165"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#hRunTermOutput"><span class="hs-identifier hs-type">hRunTermOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span id="hRunTermOutput"><span class="annot"><span class="annottext">hRunTermOutput :: Handle -&gt; Terminal -&gt; TermOutput -&gt; IO ()
</span><a href="System.Console.Terminfo.Base.html#hRunTermOutput"><span class="hs-identifier hs-var hs-var">hRunTermOutput</span></a></span></span><span> </span><span id="local-6989586621679044760"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679044760"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679044761"><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044761"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span> </span><span id="local-6989586621679044762"><span class="annot"><span class="annottext">[TermOutputType] -&gt; [TermOutputType]
</span><a href="#local-6989586621679044762"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679044763"><span class="annot"><a href="#local-6989586621679044763"><span class="hs-identifier hs-var">putc_ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CharOutput -&gt; IO (FunPtr CharOutput)
</span><a href="System.Console.Terminfo.Base.html#mkCallback"><span class="hs-identifier hs-var">mkCallback</span></a></span><span> </span><span class="annot"><span class="annottext">CharOutput
forall {b}. Enum b =&gt; b -&gt; IO b
</span><a href="#local-6989586621679044765"><span class="hs-identifier hs-var">putc</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-type">withCurTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044761"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#writeToTerm"><span class="hs-identifier hs-type">writeToTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044763"><span class="hs-identifier hs-type">putc_ptr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044760"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679044762"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">freeHaskellFunPtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679044763"><span class="hs-identifier hs-type">putc_ptr</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">hFlush</span></span><span> </span><span class="annot"><a href="#local-6989586621679044760"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679044765"><span class="annot"><span class="annottext">putc :: b -&gt; IO b
</span><a href="#local-6989586621679044765"><span class="hs-identifier hs-var hs-var">putc</span></a></span></span><span> </span><span id="local-6989586621679044774"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679044774"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679044778"><span class="annot"><span class="annottext">c' :: Char
</span><a href="#local-6989586621679044778"><span class="hs-identifier hs-var hs-var">c'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char
forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Char) -&gt; Int -&gt; Char
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679044774"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-173"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Char -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutChar</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679044760"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679044778"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hFlush</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679044760"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO b -&gt; IO b
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679044774"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- NOTE: Currently, the output is checked every time tparm is called.</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- It might be faster to check for padding once in tiGetOutput1.</span><span>
</span><span id="line-177"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#writeToTerm"><span class="hs-identifier hs-type">writeToTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier hs-type">TermOutputType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span id="writeToTerm"><span class="annot"><span class="annottext">writeToTerm :: FunPtr CharOutput -&gt; Handle -&gt; TermOutputType -&gt; IO ()
</span><a href="System.Console.Terminfo.Base.html#writeToTerm"><span class="hs-identifier hs-var hs-var">writeToTerm</span></a></span></span><span> </span><span id="local-6989586621679044782"><span class="annot"><span class="annottext">FunPtr CharOutput
</span><a href="#local-6989586621679044782"><span class="hs-identifier hs-var">putc</span></a></span></span><span> </span><span id="local-6989586621679044783"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679044783"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#TOCmd"><span class="hs-identifier hs-type">TOCmd</span></a></span><span> </span><span id="local-6989586621679044784"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044784"><span class="hs-identifier hs-var">numLines</span></a></span></span><span> </span><span id="local-6989586621679044785"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044785"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044785"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; FunPtr CharOutput -&gt; IO ()
</span><a href="System.Console.Terminfo.Base.html#tPuts"><span class="hs-identifier hs-var">tPuts</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044785"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044784"><span class="hs-identifier hs-var">numLines</span></a></span><span> </span><span class="annot"><span class="annottext">FunPtr CharOutput
</span><a href="#local-6989586621679044782"><span class="hs-identifier hs-var">putc</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStr</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679044783"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044785"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-181"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#writeToTerm"><span class="hs-identifier hs-var">writeToTerm</span></a></span><span> </span><span class="annot"><span class="annottext">FunPtr CharOutput
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679044788"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679044788"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#TOStr"><span class="hs-identifier hs-type">TOStr</span></a></span><span> </span><span id="local-6989586621679044789"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044789"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStr</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679044788"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044789"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">2</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#%3C%23%3E"><span class="hs-operator hs-type">&lt;#&gt;</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><span class="hs-comment">-- | An operator version of 'mappend'.</span></span><span>
</span><span id="line-186"></span><span id="local-6989586621679044506"><span class="annot"><a href="System.Console.Terminfo.Base.html#%3C%23%3E"><span class="hs-operator hs-type">(&lt;#&gt;)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679044506"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679044506"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679044506"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679044506"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-187"></span><span id="%3C%23%3E"><span class="annot"><span class="annottext">&lt;#&gt; :: forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="System.Console.Terminfo.Base.html#%3C%23%3E"><span class="hs-operator hs-var hs-var">(&lt;#&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-identifier hs-var">mappend</span></span><span>
</span><span id="line-188"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><span class="hs-comment">-- | A feature or operation which a 'Terminal' may define.</span></span><span>
</span><span id="line-191"></span><span class="hs-keyword">newtype</span><span> </span><span id="Capability"><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span></span><span> </span><span id="local-6989586621679044515"><span class="annot"><a href="#local-6989586621679044515"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Capability"><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679044515"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span id="local-6989586621679044508"><span class="annot"><a href="System.Console.Terminfo.Base.html#getCapability"><span class="hs-identifier hs-type">getCapability</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044508"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679044508"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-194"></span><span id="getCapability"><span class="annot"><span class="annottext">getCapability :: forall a. Terminal -&gt; Capability a -&gt; Maybe a
</span><a href="System.Console.Terminfo.Base.html#getCapability"><span class="hs-identifier hs-var hs-var">getCapability</span></a></span></span><span> </span><span id="local-6989586621679044793"><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044793"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span id="local-6989586621679044794"><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044794"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; Maybe a
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe a) -&gt; Maybe a) -&gt; IO (Maybe a) -&gt; Maybe a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a) -&gt; IO (Maybe a)
forall a. Terminal -&gt; IO a -&gt; IO a
</span><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-var">withCurTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044793"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044794"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044793"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- Note that the instances for Capability of Functor, Monad and MonadPlus </span><span>
</span><span id="line-197"></span><span class="hs-comment">-- use the corresponding instances for Maybe.</span><span>
</span><span id="line-198"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044797"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679044804"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Capability a -&gt; Capability b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679044805"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679044805"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span id="local-6989586621679044806"><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044806"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe b)) -&gt; Capability b
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe b)) -&gt; Capability b)
-&gt; (Terminal -&gt; IO (Maybe b)) -&gt; Capability b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044807"><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044807"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; Maybe b) -&gt; IO (Maybe a) -&gt; IO (Maybe b)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679044805"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044806"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044807"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044813"><span id="local-6989586621679044817"><span id="local-6989586621679044820"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621679044825"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; Capability a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe a)) -&gt; Capability a
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe a)) -&gt; Capability a)
-&gt; (a -&gt; Terminal -&gt; IO (Maybe a)) -&gt; a -&gt; Capability a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; Terminal -&gt; IO (Maybe a)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe a) -&gt; Terminal -&gt; IO (Maybe a))
-&gt; (a -&gt; IO (Maybe a)) -&gt; a -&gt; Terminal -&gt; IO (Maybe a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; IO (Maybe a)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; IO (Maybe a)) -&gt; (a -&gt; Maybe a) -&gt; a -&gt; IO (Maybe a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621679044828"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. Capability (a -&gt; b) -&gt; Capability a -&gt; Capability b
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Capability (a -&gt; b) -&gt; Capability a -&gt; Capability b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044834"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679044839"><span class="annot"><span class="annottext">return :: forall a. a -&gt; Capability a
</span><span class="hs-identifier hs-var hs-var hs-var">return</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Capability a
forall a. a -&gt; Capability a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span id="local-6989586621679044842"><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044842"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679044843"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. Capability a -&gt; (a -&gt; Capability b) -&gt; Capability b
</span><span class="hs-operator hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621679044844"><span class="annot"><span class="annottext">a -&gt; Capability b
</span><a href="#local-6989586621679044844"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe b)) -&gt; Capability b
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe b)) -&gt; Capability b)
-&gt; (Terminal -&gt; IO (Maybe b)) -&gt; Capability b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044845"><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044845"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>        </span><span id="local-6989586621679044846"><span class="annot"><a href="#local-6989586621679044846"><span class="hs-identifier hs-var">mx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044845"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679044846"><span class="hs-identifier hs-type">mx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-210"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe b -&gt; IO (Maybe b)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe b
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679044847"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679044847"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span id="local-6989586621679044848"><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe b)
</span><a href="#local-6989586621679044848"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Capability b
</span><a href="#local-6989586621679044844"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679044847"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe b)
</span><a href="#local-6989586621679044848"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044845"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044854"><span id="local-6989586621679044857"><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679044862"><span class="annot"><span class="annottext">&lt;|&gt; :: forall a. Capability a -&gt; Capability a -&gt; Capability a
</span><a href="#local-6989586621679044862"><span class="hs-operator hs-var hs-var hs-var">(&lt;|&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Capability a -&gt; Capability a -&gt; Capability a
forall a. Capability a -&gt; Capability a -&gt; Capability a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">mplus</span></span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679044866"><span class="annot"><span class="annottext">empty :: forall a. Capability a
</span><a href="#local-6989586621679044866"><span class="hs-identifier hs-var hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Capability a
forall a. Capability a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621679044877"><span class="annot"><span class="annottext">mzero :: forall a. Capability a
</span><span class="hs-identifier hs-var hs-var hs-var">mzero</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe a)) -&gt; Capability a
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; Terminal -&gt; IO (Maybe a)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe a) -&gt; Terminal -&gt; IO (Maybe a))
-&gt; IO (Maybe a) -&gt; Terminal -&gt; IO (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; IO (Maybe a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span id="local-6989586621679044880"><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044880"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679044881"><span class="annot"><span class="annottext">mplus :: forall a. Capability a -&gt; Capability a -&gt; Capability a
</span><span class="hs-operator hs-var hs-var hs-var">`mplus`</span></span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span id="local-6989586621679044882"><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044882"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe a)) -&gt; Capability a
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe a)) -&gt; Capability a)
-&gt; (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044883"><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044883"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>        </span><span id="local-6989586621679044884"><span class="annot"><a href="#local-6989586621679044884"><span class="hs-identifier hs-var">mx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044880"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044883"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679044884"><span class="hs-identifier hs-type">mx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-222"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Terminal -&gt; IO (Maybe a)
</span><a href="#local-6989586621679044882"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044883"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; IO (Maybe a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679044884"><span class="hs-identifier hs-var">mx</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span id="tigetnum"><span class="annot"><a href="System.Console.Terminfo.Base.html#tigetnum"><span class="hs-identifier hs-var">tigetnum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><span class="hs-comment">-- | Look up a numeric capability in the terminfo database.</span></span><span>
</span><span id="line-228"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetNum"><span class="hs-identifier hs-type">tiGetNum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span>
</span><span id="line-229"></span><span id="tiGetNum"><span class="annot"><span class="annottext">tiGetNum :: String -&gt; Capability Int
</span><a href="System.Console.Terminfo.Base.html#tiGetNum"><span class="hs-identifier hs-var hs-var">tiGetNum</span></a></span></span><span> </span><span id="local-6989586621679044886"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044886"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe Int)) -&gt; Capability Int
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe Int)) -&gt; Capability Int)
-&gt; (Terminal -&gt; IO (Maybe Int)) -&gt; Capability Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe Int) -&gt; Terminal -&gt; IO (Maybe Int)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Int) -&gt; Terminal -&gt; IO (Maybe Int))
-&gt; IO (Maybe Int) -&gt; Terminal -&gt; IO (Maybe Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>                </span><span id="local-6989586621679044887"><span class="annot"><a href="#local-6989586621679044887"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CInt -&gt; Int) -&gt; IO CInt -&gt; IO Int
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO CInt) -&gt; IO CInt
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044886"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">CString -&gt; IO CInt
</span><a href="System.Console.Terminfo.Base.html#tigetnum"><span class="hs-identifier hs-var">tigetnum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679044887"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-232"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679044887"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span id="tigetflag"><span class="annot"><a href="System.Console.Terminfo.Base.html#tigetflag"><span class="hs-identifier hs-var">tigetflag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Look up a boolean capability in the terminfo database.  </span><span>
</span><span id="line-237"></span><span class="hs-comment">-- </span><span>
</span><span id="line-238"></span><span class="hs-comment">-- Unlike 'tiGuardFlag', this capability never fails; it returns 'False' if the</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- capability is absent or set to false, and returns 'True' otherwise.  </span><span>
</span><span id="line-240"></span><span class="hs-comment">-- </span><span>
</span><span id="line-241"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetFlag"><span class="hs-identifier hs-type">tiGetFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-242"></span><span id="tiGetFlag"><span class="annot"><span class="annottext">tiGetFlag :: String -&gt; Capability Bool
</span><a href="System.Console.Terminfo.Base.html#tiGetFlag"><span class="hs-identifier hs-var hs-var">tiGetFlag</span></a></span></span><span> </span><span id="local-6989586621679044889"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044889"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe Bool)) -&gt; Capability Bool
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe Bool)) -&gt; Capability Bool)
-&gt; (Terminal -&gt; IO (Maybe Bool)) -&gt; Capability Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe Bool) -&gt; Terminal -&gt; IO (Maybe Bool)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Bool) -&gt; Terminal -&gt; IO (Maybe Bool))
-&gt; IO (Maybe Bool) -&gt; Terminal -&gt; IO (Maybe Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CInt -&gt; Maybe Bool) -&gt; IO CInt -&gt; IO (Maybe Bool)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe Bool) -&gt; (CInt -&gt; Bool) -&gt; CInt -&gt; Maybe Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CInt -&gt; CInt -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span class="annot"><span class="annottext">CInt
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO CInt -&gt; IO (Maybe Bool)) -&gt; IO CInt -&gt; IO (Maybe Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-243"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO CInt) -&gt; IO CInt
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044889"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">CString -&gt; IO CInt
</span><a href="System.Console.Terminfo.Base.html#tigetflag"><span class="hs-identifier hs-var">tigetflag</span></a></span><span>
</span><span id="line-244"></span><span>                </span><span>
</span><span id="line-245"></span><span class="hs-comment">-- | Look up a boolean capability in the terminfo database, and fail if</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- it\'s not defined.</span><span>
</span><span id="line-247"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGuardFlag"><span class="hs-identifier hs-type">tiGuardFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span id="tiGuardFlag"><span class="annot"><span class="annottext">tiGuardFlag :: String -&gt; Capability ()
</span><a href="System.Console.Terminfo.Base.html#tiGuardFlag"><span class="hs-identifier hs-var hs-var">tiGuardFlag</span></a></span></span><span> </span><span id="local-6989586621679044891"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044891"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Capability Bool
</span><a href="System.Console.Terminfo.Base.html#tiGetFlag"><span class="hs-identifier hs-var">tiGetFlag</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044891"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">Capability Bool -&gt; (Bool -&gt; Capability ()) -&gt; Capability ()
forall a b. Capability a -&gt; (a -&gt; Capability b) -&gt; Capability b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Capability ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span>
</span><span id="line-249"></span><span>                </span><span>
</span><span id="line-250"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span id="tigetstr"><span class="annot"><a href="System.Console.Terminfo.Base.html#tigetstr"><span class="hs-identifier hs-var">tigetstr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">tiGetStr</span><span> </span><span class="hs-pragma">&quot;use tiGetOutput instead.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span>
</span><span id="line-253"></span><span class="hs-comment">-- | Look up a string capability in the terminfo database.  NOTE: This function is deprecated; use</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- 'tiGetOutput1' instead.</span><span>
</span><span id="line-255"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier hs-type">tiGetStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-256"></span><span id="tiGetStr"><span class="annot"><span class="annottext">tiGetStr :: String -&gt; Capability String
</span><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier hs-var hs-var">tiGetStr</span></a></span></span><span> </span><span id="local-6989586621679044893"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044893"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe String)) -&gt; Capability String
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe String)) -&gt; Capability String)
-&gt; (Terminal -&gt; IO (Maybe String)) -&gt; Capability String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe String) -&gt; Terminal -&gt; IO (Maybe String)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe String) -&gt; Terminal -&gt; IO (Maybe String))
-&gt; IO (Maybe String) -&gt; Terminal -&gt; IO (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>                </span><span id="local-6989586621679044894"><span class="annot"><a href="#local-6989586621679044894"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO CString) -&gt; IO CString
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044893"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">CString -&gt; IO CString
</span><a href="System.Console.Terminfo.Base.html#tigetstr"><span class="hs-identifier hs-var">tigetstr</span></a></span><span> </span><span>
</span><span id="line-258"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679044894"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">nullPtr</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="#local-6989586621679044894"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621679044896"><span class="hs-identifier hs-type">neg1Ptr</span></a></span><span>
</span><span id="line-259"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-260"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">peekCString</span></span><span> </span><span class="annot"><a href="#local-6989586621679044894"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-comment">-- hack; tigetstr sometimes returns (-1)</span><span>
</span><span id="line-263"></span><span>        </span><span id="local-6989586621679044896"><span class="annot"><span class="annottext">neg1Ptr :: Ptr b
</span><a href="#local-6989586621679044896"><span class="hs-identifier hs-var hs-var">neg1Ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 0)
forall a. Ptr a
</span><span class="hs-identifier hs-var">nullPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 0) -&gt; Int -&gt; Ptr b
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>                    </span><span>
</span><span id="line-270"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">capi</span></span><span> </span><span class="annot"><span class="hs-string">&quot;term.h tparm&quot;</span></span><span>
</span><span id="line-271"></span><span>    </span><span id="tparm"><span class="annot"><a href="System.Console.Terminfo.Base.html#tparm"><span class="hs-identifier hs-var">tparm</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-comment">-- p1,...,p9</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-comment">-- Note: I may want to cut out the middleman and pipe tGoto/tGetStr together</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- with tput without a String marshall in the middle.</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- directly without </span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tParm"><span class="hs-identifier hs-type">tParm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span id="tParm"><span class="annot"><span class="annottext">tParm :: String -&gt; Capability ([Int] -&gt; String)
</span><a href="System.Console.Terminfo.Base.html#tParm"><span class="hs-identifier hs-var hs-var">tParm</span></a></span></span><span> </span><span id="local-6989586621679044903"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044903"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Terminal -&gt; IO (Maybe ([Int] -&gt; String)))
-&gt; Capability ([Int] -&gt; String)
forall a. (Terminal -&gt; IO (Maybe a)) -&gt; Capability a
</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a></span><span> </span><span class="annot"><span class="annottext">((Terminal -&gt; IO (Maybe ([Int] -&gt; String)))
 -&gt; Capability ([Int] -&gt; String))
-&gt; (Terminal -&gt; IO (Maybe ([Int] -&gt; String)))
-&gt; Capability ([Int] -&gt; String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044904"><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044904"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ([Int] -&gt; String) -&gt; IO (Maybe ([Int] -&gt; String))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ([Int] -&gt; String) -&gt; IO (Maybe ([Int] -&gt; String)))
-&gt; Maybe ([Int] -&gt; String) -&gt; IO (Maybe ([Int] -&gt; String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; String) -&gt; Maybe ([Int] -&gt; String)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">(([Int] -&gt; String) -&gt; Maybe ([Int] -&gt; String))
-&gt; ([Int] -&gt; String) -&gt; Maybe ([Int] -&gt; String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044905"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044905"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; String
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; String) -&gt; IO String -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Terminal -&gt; IO String -&gt; IO String
forall a. Terminal -&gt; IO a -&gt; IO a
</span><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-var">withCurTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Terminal
</span><a href="#local-6989586621679044904"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IO String) -&gt; IO String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-282"></span><span>                    </span><span class="annot"><span class="annottext">[CLong] -&gt; IO String
</span><a href="#local-6989586621679044906"><span class="hs-identifier hs-var">tparm'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; CLong) -&gt; [Int] -&gt; [CLong]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CLong
forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044905"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[CLong] -&gt; [CLong] -&gt; [CLong]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">CLong -&gt; [CLong]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">CLong
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679044906"><span class="annot"><span class="annottext">tparm' :: [CLong] -&gt; IO String
</span><a href="#local-6989586621679044906"><span class="hs-identifier hs-var hs-var">tparm'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679044913"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044913"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044914"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044914"><span class="hs-identifier hs-var">p2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044915"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044915"><span class="hs-identifier hs-var">p3</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044916"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044916"><span class="hs-identifier hs-var">p4</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044917"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044917"><span class="hs-identifier hs-var">p5</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044918"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044918"><span class="hs-identifier hs-var">p6</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044919"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044919"><span class="hs-identifier hs-var">p7</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044920"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044920"><span class="hs-identifier hs-var">p8</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679044921"><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044921"><span class="hs-identifier hs-var">p9</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[CLong]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO String) -&gt; IO String
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044903"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">((CString -&gt; IO String) -&gt; IO String)
-&gt; (CString -&gt; IO String) -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044922"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679044922"><span class="hs-identifier hs-var">c_cap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>                </span><span id="local-6989586621679044923"><span class="annot"><a href="#local-6989586621679044923"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CString
-&gt; CLong
-&gt; CLong
-&gt; CLong
-&gt; CLong
-&gt; CLong
-&gt; CLong
-&gt; CLong
-&gt; CLong
-&gt; CLong
-&gt; IO CString
</span><a href="System.Console.Terminfo.Base.html#tparm"><span class="hs-identifier hs-var">tparm</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679044922"><span class="hs-identifier hs-var">c_cap</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044913"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044914"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044915"><span class="hs-identifier hs-var">p3</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044916"><span class="hs-identifier hs-var">p4</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044917"><span class="hs-identifier hs-var">p5</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044918"><span class="hs-identifier hs-var">p6</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044919"><span class="hs-identifier hs-var">p7</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044920"><span class="hs-identifier hs-var">p8</span></a></span><span> </span><span class="annot"><span class="annottext">CLong
</span><a href="#local-6989586621679044921"><span class="hs-identifier hs-var">p9</span></a></span><span>
</span><span id="line-286"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679044923"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">nullPtr</span></span><span>
</span><span id="line-287"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-288"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">peekCString</span></span><span> </span><span class="annot"><a href="#local-6989586621679044923"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="annot"><a href="#local-6989586621679044906"><span class="hs-identifier hs-var">tparm'</span></a></span><span> </span><span class="annot"><span class="annottext">[CLong]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. String -&gt; IO a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tParm: List too short&quot;</span></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="annot"><span class="hs-comment">-- | Look up an output capability in the terminfo database.  </span></span><span>
</span><span id="line-292"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetOutput"><span class="hs-identifier hs-type">tiGetOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span id="tiGetOutput"><span class="annot"><span class="annottext">tiGetOutput :: String -&gt; Capability ([Int] -&gt; Int -&gt; TermOutput)
</span><a href="System.Console.Terminfo.Base.html#tiGetOutput"><span class="hs-identifier hs-var hs-var">tiGetOutput</span></a></span></span><span> </span><span id="local-6989586621679044924"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044924"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621679044925"><span class="annot"><a href="#local-6989586621679044925"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Capability String
</span><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier hs-var">tiGetStr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044924"><span class="hs-identifier hs-var">cap</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621679044926"><span class="annot"><a href="#local-6989586621679044926"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tParm"><span class="hs-identifier hs-type">tParm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044925"><span class="hs-identifier hs-type">str</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044927"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044927"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679044928"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044928"><span class="hs-identifier hs-var">la</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#fromStr"><span class="hs-identifier hs-var">fromStr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044928"><span class="hs-identifier hs-var">la</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TermOutput) -&gt; String -&gt; TermOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621679044926"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044927"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#fromStr"><span class="hs-identifier hs-type">fromStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span>
</span><span id="line-299"></span><span id="fromStr"><span class="annot"><span class="annottext">fromStr :: Int -&gt; String -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#fromStr"><span class="hs-identifier hs-var hs-var">fromStr</span></a></span></span><span> </span><span id="local-6989586621679044930"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044930"><span class="hs-identifier hs-var">la</span></a></span></span><span> </span><span id="local-6989586621679044931"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044931"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([TermOutputType] -&gt; [TermOutputType]) -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String -&gt; TermOutputType
</span><a href="System.Console.Terminfo.Base.html#TOCmd"><span class="hs-identifier hs-var">TOCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044930"><span class="hs-identifier hs-var">la</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044931"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TermOutputType -&gt; [TermOutputType] -&gt; [TermOutputType]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-keyword">type</span><span> </span><span id="CharOutput"><span class="annot"><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-var">CharOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;wrapper&quot;</span></span><span> </span><span id="mkCallback"><span class="annot"><a href="System.Console.Terminfo.Base.html#mkCallback"><span class="hs-identifier hs-var">mkCallback</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span id="tputs"><span class="annot"><a href="System.Console.Terminfo.Base.html#tputs"><span class="hs-identifier hs-var">tputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-comment">-- | A parameter to specify the number of lines affected.  Some capabilities</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- (e.g., @clear@ and @dch1@) use</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- this parameter on some terminals to compute variable-length padding.</span><span>
</span><span id="line-310"></span><span class="hs-keyword">type</span><span> </span><span id="LinesAffected"><span class="annot"><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-var">LinesAffected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="hs-comment">-- | Output a string capability.  Applies padding information to the string if</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-314"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tPuts"><span class="hs-identifier hs-type">tPuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span id="tPuts"><span class="annot"><span class="annottext">tPuts :: String -&gt; Int -&gt; FunPtr CharOutput -&gt; IO ()
</span><a href="System.Console.Terminfo.Base.html#tPuts"><span class="hs-identifier hs-var hs-var">tPuts</span></a></span></span><span> </span><span id="local-6989586621679044933"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044933"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679044934"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044934"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679044935"><span class="annot"><span class="annottext">FunPtr CharOutput
</span><a href="#local-6989586621679044935"><span class="hs-identifier hs-var">putc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (CString -&gt; IO ()) -&gt; IO ()
forall a. String -&gt; (CString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044933"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">((CString -&gt; IO ()) -&gt; IO ()) -&gt; (CString -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044936"><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679044936"><span class="hs-identifier hs-var">c_str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CString -&gt; CInt -&gt; FunPtr CharOutput -&gt; IO ()
</span><a href="System.Console.Terminfo.Base.html#tputs"><span class="hs-identifier hs-var">tputs</span></a></span><span> </span><span class="annot"><span class="annottext">CString
</span><a href="#local-6989586621679044936"><span class="hs-identifier hs-var">c_str</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CInt
forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679044934"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunPtr CharOutput
</span><a href="#local-6989586621679044935"><span class="hs-identifier hs-var">putc</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-comment">-- | Look up an output capability which takes a fixed number of parameters</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- (for example, @Int -&gt; Int -&gt; TermOutput@).</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- </span><span>
</span><span id="line-321"></span><span class="hs-comment">-- For capabilities which may contain variable-length</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- padding, use 'tiGetOutput' instead.</span><span>
</span><span id="line-323"></span><span class="annot"><a href="System.Console.Terminfo.Base.html#tiGetOutput1"><span class="hs-identifier hs-type">tiGetOutput1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679044562"><span class="annot"><a href="#local-6989586621679044562"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044562"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044562"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-324"></span><span id="tiGetOutput1"><span class="annot"><span class="annottext">tiGetOutput1 :: forall f. OutputCap f =&gt; String -&gt; Capability f
</span><a href="System.Console.Terminfo.Base.html#tiGetOutput1"><span class="hs-identifier hs-var hs-var">tiGetOutput1</span></a></span></span><span> </span><span id="local-6989586621679044947"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044947"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621679044948"><span class="annot"><a href="#local-6989586621679044948"><span class="hs-identifier hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Capability String
</span><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier hs-var">tiGetStr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679044947"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-type">hasOkPadding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">undefined</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679044562"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679044948"><span class="hs-identifier hs-type">cap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679044951"><span class="annot"><a href="#local-6989586621679044951"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#tParm"><span class="hs-identifier hs-type">tParm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044948"><span class="hs-identifier hs-type">cap</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-type">outputCap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044951"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- OK, this is the structure that I want:</span><span>
</span><span id="line-332"></span><span class="hs-keyword">class</span><span> </span><span id="OutputCap"><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-var">OutputCap</span></a></span></span><span> </span><span id="local-6989586621679044565"><span class="annot"><a href="#local-6989586621679044565"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-333"></span><span>    </span><span id="hasOkPadding"><span class="annot"><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-type">hasOkPadding</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679044565"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-334"></span><span>    </span><span id="outputCap"><span class="annot"><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-type">outputCap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679044565"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621679044957"><span class="annot"><span class="annottext">hasOkPadding :: String -&gt; String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-var hs-var hs-var">hasOkPadding</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (String -&gt; Bool) -&gt; String -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a></span><span> </span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621679044959"><span class="annot"><span class="annottext">outputCap :: ([Int] -&gt; String) -&gt; [Int] -&gt; String
</span><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-var hs-var hs-var">outputCap</span></a></span></span><span> </span><span id="local-6989586621679044960"><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621679044960"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679044961"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044961"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621679044960"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044961"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>    </span><span id="local-6989586621679044966"><span class="annot"><span class="annottext">hasOkPadding :: TermOutput -&gt; String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-var hs-var hs-var">hasOkPadding</span></a></span></span><span> </span><span class="annot"><span class="annottext">TermOutput
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-342"></span><span>    </span><span id="local-6989586621679044967"><span class="annot"><span class="annottext">outputCap :: ([Int] -&gt; String) -&gt; [Int] -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-var hs-var hs-var">outputCap</span></a></span></span><span> </span><span id="local-6989586621679044968"><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621679044968"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679044969"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044969"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; TermOutput
</span><a href="System.Console.Terminfo.Base.html#fromStr"><span class="hs-identifier hs-var">fromStr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TermOutput) -&gt; String -&gt; TermOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621679044968"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; String) -&gt; [Int] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044969"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679044571"><span id="local-6989586621679044572"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679044571"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044572"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679044571"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679044572"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621679044977"><span class="annot"><span class="annottext">outputCap :: ([Int] -&gt; String) -&gt; [Int] -&gt; p -&gt; f
</span><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-var hs-var hs-var">outputCap</span></a></span></span><span> </span><span id="local-6989586621679044978"><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621679044978"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679044979"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044979"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679044980"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679044980"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; String) -&gt; [Int] -&gt; f
forall f. OutputCap f =&gt; ([Int] -&gt; String) -&gt; [Int] -&gt; f
</span><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-var">outputCap</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; String
</span><a href="#local-6989586621679044978"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">p -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679044980"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679044979"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679044984"><span class="annot"><span class="annottext">hasOkPadding :: (p -&gt; f) -&gt; String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-var hs-var hs-var">hasOkPadding</span></a></span></span><span> </span><span class="annot"><span class="annottext">p -&gt; f
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f -&gt; String -&gt; Bool
forall f. OutputCap f =&gt; f -&gt; String -&gt; Bool
</span><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-var">hasOkPadding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679044572"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="annot"><span class="hs-comment">{- $outputdoc
Terminfo contains many string capabilities for special effects.
For example, the @cuu1@ capability moves the cursor up one line; on ANSI terminals
this is accomplished by printing the control sequence @\&quot;\\ESC[A\&quot;@.
However, some older terminals also require \&quot;padding\&quot;, or short pauses, after certain commands.
For example, when @TERM=vt100@ the @cuu1@ capability is @\&quot;\\ESC[A$\&lt;2\&gt;\&quot;@, which instructs terminfo
to pause for two milliseconds after outputting the control sequence.

The 'TermOutput' monoid abstracts away all padding and control
sequence output.  Unfortunately, that datatype is difficult to integrate into existing 'String'-based APIs
such as pretty-printers.  Thus, as a workaround, 'tiGetOutput1' also lets us access the control sequences as 'String's.  The one caveat is that it will not allow you to access padded control sequences as Strings.  For example:

   &gt; &gt; t &lt;- setupTerm &quot;vt100&quot;
   &gt; &gt; isJust (getCapability t (tiGetOutput1 &quot;cuu1&quot;) :: Maybe String)
   &gt; False
   &gt; &gt; isJust (getCapability t (tiGetOutput1 &quot;cuu1&quot;) :: Maybe TermOutput)
   &gt; True

'String' capabilities will work with software-based terminal types such as @xterm@ and @linux@.
However, you should use 'TermOutput' if compatibility with older terminals is important.
Additionally, the @visualBell@ capability which flashes the screen usually produces its effect with a padding directive, so it will only work with 'TermOutput'.

-}</span></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679044573"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679044573"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="TermStr"><span class="annot"><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier hs-var">TermStr</span></a></span></span><span> </span><span id="local-6989586621679044573"><span class="annot"><a href="#local-6989586621679044573"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier hs-type">TermStr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-377"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier hs-type">TermStr</span></a></span><span> </span><span class="annot"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a></span><span>
</span><span id="line-378"></span></pre></body></html>